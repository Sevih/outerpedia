'use client'

import { useState, useEffect } from 'react'
import type { TenantKey } from '@/tenants/config'

type ShareButtonsProps = {
  title: string
  url?: string
  lang?: TenantKey
}

export default function ShareButtons({ title, url, lang = 'en' }: ShareButtonsProps) {
  const [copied, setCopied] = useState(false)
  const [shareUrl, setShareUrl] = useState(url || '')

  // Get current URL on client side only to avoid hydration mismatch
  useEffect(() => {
    if (!url && typeof window !== 'undefined') {
      setShareUrl(window.location.href)
    }
  }, [url])

  const shareTitle = encodeURIComponent(title)

  const handleCopyLink = async () => {
    try {
      await navigator.clipboard.writeText(shareUrl)
      setCopied(true)
      setTimeout(() => setCopied(false), 2000)
    } catch (err) {
      console.error('Failed to copy:', err)
    }
  }

  const shareLinks = {
    twitter: `https://twitter.com/intent/tweet?text=${shareTitle}&url=${encodeURIComponent(shareUrl)}`,
    facebook: `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(shareUrl)}`,
    reddit: `https://reddit.com/submit?url=${encodeURIComponent(shareUrl)}&title=${shareTitle}`,
    telegram: `https://t.me/share/url?url=${encodeURIComponent(shareUrl)}&text=${shareTitle}`,
    whatsapp: `https://wa.me/?text=${shareTitle}%20${encodeURIComponent(shareUrl)}`,
    // Japan
    line: `https://social-plugins.line.me/lineit/share?url=${encodeURIComponent(shareUrl)}`,
    // Korea
    kakaotalk: `https://story.kakao.com/share?url=${encodeURIComponent(shareUrl)}`,
    naver: `https://share.naver.com/web/shareView?url=${encodeURIComponent(shareUrl)}&title=${shareTitle}`,
    // China
    weibo: `https://service.weibo.com/share/share.php?url=${encodeURIComponent(shareUrl)}&title=${shareTitle}`,
    qq: `https://connect.qq.com/widget/shareqq/index.html?url=${encodeURIComponent(shareUrl)}&title=${shareTitle}`,
  }

  // Define which platforms to show based on language
  const getPlatforms = () => {
    switch (lang) {
      case 'jp':
        return ['line', 'twitter', 'reddit'] as const
      case 'kr':
        return ['kakaotalk', 'naver', 'twitter'] as const
      case 'zh':
        return ['weibo', 'qq', 'twitter'] as const
      case 'en':
      default:
        return ['twitter', 'reddit', 'facebook', 'telegram', 'whatsapp'] as const
    }
  }

  const platforms = getPlatforms()

  // Platform configs with icons and colors
  const platformConfig = {
    twitter: {
      label: 'Twitter',
      color: 'hover:text-sky-400',
      icon: 'M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z'
    },
    facebook: {
      label: 'Facebook',
      color: 'hover:text-blue-500',
      icon: 'M9.101 23.691v-7.98H6.627v-3.667h2.474v-1.58c0-4.085 1.848-5.978 5.858-5.978.401 0 .955.042 1.468.103a8.68 8.68 0 0 1 1.141.195v3.325a8.623 8.623 0 0 0-.653-.036 26.805 26.805 0 0 0-.733-.009c-.707 0-1.259.096-1.675.309a1.686 1.686 0 0 0-.679.622c-.258.42-.374.995-.374 1.752v1.297h3.919l-.386 3.667h-3.533v7.98H9.101z'
    },
    reddit: {
      label: 'Reddit',
      color: 'hover:text-orange-500',
      icon: 'M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 0 1-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 0 1 .042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 0 1 4.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 0 1 .14-.197.35.35 0 0 1 .238-.042l2.906.617a1.214 1.214 0 0 1 1.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 0 0-.231.094.33.33 0 0 0 0 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 0 0 .029-.463.33.33 0 0 0-.464 0c-.547.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 0 0-.232-.095z'
    },
    telegram: {
      label: 'Telegram',
      color: 'hover:text-sky-500',
      icon: 'M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm5.894 8.221l-1.97 9.28c-.145.658-.537.818-1.084.508l-3-2.21-1.446 1.394c-.14.18-.357.295-.6.295-.002 0-.003 0-.005 0l.213-3.054 5.56-5.022c.24-.213-.054-.334-.373-.121l-6.869 4.326-2.96-.924c-.64-.203-.658-.64.135-.954l11.566-4.458c.538-.196 1.006.128.832.941z'
    },
    whatsapp: {
      label: 'WhatsApp',
      color: 'hover:text-green-500',
      icon: 'M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z'
    },
    line: {
      label: 'LINE',
      color: 'hover:text-green-500',
      icon: 'M19.365 9.863c.349 0 .63.285.63.631 0 .345-.281.63-.63.63H17.61v1.125h1.755c.349 0 .63.283.63.63 0 .344-.281.629-.63.629h-2.386c-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63h2.386c.346 0 .627.285.627.63 0 .349-.281.63-.63.63H17.61v1.125h1.755zm-3.855 3.016c0 .27-.174.51-.432.596-.064.021-.133.031-.199.031-.211 0-.391-.09-.51-.25l-2.443-3.317v2.94c0 .344-.279.629-.631.629-.346 0-.626-.285-.626-.629V8.108c0-.27.173-.51.43-.595.06-.023.136-.033.194-.033.195 0 .375.105.495.254l2.462 3.33V8.108c0-.345.282-.63.63-.63.345 0 .63.285.63.63v4.771zm-5.741 0c0 .344-.282.629-.631.629-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63.346 0 .628.285.628.63v4.771zm-2.466.629H4.917c-.345 0-.63-.285-.63-.629V8.108c0-.345.285-.63.63-.63.348 0 .63.285.63.63v4.141h1.756c.348 0 .629.283.629.63 0 .344-.282.629-.629.629M24 10.314C24 4.943 18.615.572 12 .572S0 4.943 0 10.314c0 4.811 4.27 8.842 10.035 9.608.391.082.923.258 1.058.59.12.301.079.771.039 1.08l-.164 1.02c-.045.301-.24 1.186 1.049.645 1.291-.539 6.916-4.078 9.436-6.975C23.176 14.393 24 12.458 24 10.314'
    },
    kakaotalk: {
      label: 'KakaoTalk',
      color: 'hover:text-yellow-500',
      icon: 'M12 3c5.799 0 10.5 3.664 10.5 8.185 0 4.52-4.701 8.184-10.5 8.184a13.5 13.5 0 0 1-1.727-.11l-4.408 2.883c-.501.265-.678.236-.472-.413l.892-3.678c-2.88-1.46-4.785-3.99-4.785-6.866C1.5 6.665 6.201 3 12 3zm5.907 8.06l1.47-1.424a.472.472 0 0 0-.656-.678l-1.928 1.866V9.282a.472.472 0 0 0-.944 0v2.557a.471.471 0 0 0 0 .222V13.5a.472.472 0 0 0 .944 0v-1.363l.427-.413 1.428 2.033a.472.472 0 1 0 .773-.543l-1.514-2.155zm-2.958 1.924h-1.46V9.297a.472.472 0 0 0-.943 0v4.159c0 .26.21.472.471.472h1.932a.472.472 0 1 0 0-.944zm-5.857-1.092l.696-1.707.638 1.707H9.092zm2.523.488l.002-.016a.469.469 0 0 0-.127-.32l-1.046-2.8a.69.69 0 0 0-.627-.474.696.696 0 0 0-.653.447l-1.661 4.075a.472.472 0 0 0 .874.338l.33-.809h2.07l.337.82a.472.472 0 1 0 .874-.338l-.373-.923zM6.215 9.282a.472.472 0 0 0-.472-.472h-1.7a.472.472 0 0 0-.471.472v3.146a.472.472 0 0 0 .943 0v-1.382h.729a.472.472 0 0 0 0-.944h-.729V9.754h1.228a.472.472 0 0 0 .472-.472z'
    },
    naver: {
      label: 'Naver',
      color: 'hover:text-green-600',
      icon: 'M16.273 12.845L7.376 0H0v24h7.726V11.156L16.624 24H24V0h-7.727v12.845z'
    },
    weibo: {
      label: 'Weibo',
      color: 'hover:text-red-500',
      icon: 'M9.779 14.144c-1.664-.185-3.107-1.025-3.219-1.873-.113-.85 1.084-1.658 2.748-1.473 1.663.185 3.107 1.025 3.22 1.873.112.849-1.085 1.658-2.749 1.473zm2.816-3.461c-.283-.088-.478-.146-.33-.529.321-.833.354-1.549.007-2.061-.651-.958-2.435-.906-4.48-.024 0 0-.643.289-.479-.236.315-1.045.268-1.92-.226-2.426-1.125-1.153-4.114.043-6.675 2.671C-.584 10.19-.051 12.81-.051 12.81c.368 3.022 3.232 4.859 6.392 4.859 4.146 0 6.906-2.408 6.906-4.32 0-1.158-.973-1.816-1.452-2.166zm7.026-6.683c-1.331-1.479-3.297-2.037-5.099-1.56l.425 1.463c1.372-.363 2.938.063 3.986 1.27 1.049 1.208 1.246 2.84.651 4.11l1.439.562c.978-1.671.691-3.867-.402-5.845zM22.108 2.057C19.949-.479 16.78-0.73 14.05.284l.43 1.485c2.236-.834 4.785-.513 6.595 1.611 1.81 2.125 2.063 5.004.943 7.269l1.467.61c1.425-2.876 1.096-6.477-1.377-9.202z'
    },
    qq: {
      label: 'QQ',
      color: 'hover:text-blue-500',
      icon: 'M21.395 15.035a39.548 39.548 0 0 0-.803-2.264l-1.079-2.695c.001-.032.014-.562.014-.836 0-3.724-1.89-6.966-4.757-8.853-.151-.099-.462-.285-.574-.242-.123.047-.099.293-.099.442 0 .312-.004.627-.01.938a.062.062 0 0 1-.031.052c-.981.443-2.1.665-3.239.665-1.089 0-2.175-.208-3.125-.625a.062.062 0 0 1-.031-.052 40.566 40.566 0 0 1-.011-.938c0-.226.011-.427-.136-.626-.05-.068-.144-.101-.215-.101-.101 0-.242.054-.337.105-2.813 1.885-4.656 5.107-4.656 8.776 0 .274.013.804.013.836l-1.079 2.695a39.548 39.548 0 0 0-.803 2.264c-.528 2.053-.471 3.457.261 4.062.44.361 1.045.468 1.739.246a5.99 5.99 0 0 0 1.662-.778 11.762 11.762 0 0 0 4.827 1.029c1.857 0 3.61-.399 5.078-1.12.456.294 1.029.554 1.663.752.694.217 1.3.109 1.74-.252.732-.603.789-2.007.26-4.061zM8.062 16.1c-1.017 0-1.842-1.096-1.842-2.446s.825-2.447 1.842-2.447c1.018 0 1.843 1.097 1.843 2.447S9.08 16.1 8.062 16.1zm7.876 0c-1.017 0-1.842-1.096-1.842-2.446s.825-2.447 1.842-2.447c1.018 0 1.843 1.097 1.843 2.447S16.956 16.1 15.938 16.1z'
    }
  }

  return (
    <div className="flex items-center justify-center gap-2 text-neutral-500">
      <span className="text-xs uppercase tracking-wider">Share</span>
      <span className="text-neutral-700">|</span>

      {platforms.map((platform) => {
        const config = platformConfig[platform]
        return (
          <a
            key={platform}
            href={shareLinks[platform]}
            target="_blank"
            rel="noopener noreferrer"
            className={`text-neutral-500 ${config.color} transition-colors`}
            aria-label={`Share on ${config.label}`}
            title={`Share on ${config.label}`}
          >
            <svg className="w-4 h-4 fill-current" viewBox="0 0 24 24" aria-hidden="true">
              <path d={config.icon} />
            </svg>
          </a>
        )
      })}

      <span className="text-neutral-700">|</span>

      {/* Copy Link */}
      <button
        onClick={handleCopyLink}
        className="relative text-neutral-500 hover:text-emerald-500 transition-colors"
        aria-label="Copy link"
        title="Copy link"
        type="button"
      >
        {copied ? (
          <>
            <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
            </svg>
            <span className="absolute -top-7 left-1/2 -translate-x-1/2 px-2 py-1 bg-emerald-600 text-white text-xs rounded whitespace-nowrap pointer-events-none">
              Copied!
            </span>
          </>
        ) : (
          <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
          </svg>
        )}
      </button>
    </div>
  )
}
